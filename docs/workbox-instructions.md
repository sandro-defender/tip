# Руководство по использованию Workbox Service Worker

## Введение

Данная документация содержит информацию о внедрении и использовании service worker на основе библиотеки [Workbox](https://developers.google.com/web/tools/workbox) в проекте.

## Основные преимущества Workbox

1. **Готовые стратегии кэширования** - предоставляет несколько готовых и проверенных стратегий для разных типов контента
2. **Простой API** - упрощает создание и управление service worker
3. **Надежное управление кэшем** - автоматическое обновление и очистка устаревших кэшей
4. **Контроль размера кэша** - ограничение размера и времени хранения данных
5. **Продвинутый роутинг** - гибкие возможности для определения, что и как кэшировать

## Реализованные стратегии кэширования

В нашем проекте используются следующие стратегии:

1. **Network First** для HTML-страниц и API запросов
   - Сначала пытается получить данные из сети
   - Если сеть недоступна, возвращает кэшированный контент
   - Лучше всего подходит для часто обновляемого контента

2. **Stale While Revalidate** для JavaScript и CSS файлов
   - Возвращает кэшированные данные (если они есть)
   - Параллельно обновляет кэш свежими данными из сети
   - Баланс между производительностью и актуальностью

3. **Cache First** для изображений
   - Сначала проверяет кэш
   - Обращается к сети только если данные отсутствуют в кэше
   - Лучше всего для редко изменяемых ресурсов

## Предварительное кэширование

Следующие файлы предварительно кэшируются при установке service worker:

- `/` (главная страница)
- `/index.html`
- `/manifest.json`
- `/includes/menu.html`
- `/html/protected/tip.html`
- `/html/protected/statistics.html`
- `/html/allowed/salary.html`

## Управление жизненным циклом

В реализации предусмотрено:

1. **Обнаружение обновлений** - service worker отслеживает появление новых версий
2. **Уведомление пользователя** - пользователь получает сообщение о доступном обновлении
3. **Быстрое обновление** - возможность немедленного обновления через `skipWaiting()`

## Настройка и расширение

### Изменение стратегий кэширования

Для изменения стратегии для определенного типа файлов, найдите соответствующий блок в `workbox-service-worker.js`:

```javascript
registerRoute(
  ({ request }) => request.destination === 'image',
  new CacheFirst({
    // ... настройки ...
  })
);
```

### Добавление новых путей для кэширования

Для добавления новых путей в предварительное кэширование, обновите массив `filesToPrecache`:

```javascript
const filesToPrecache = [
  { url: '/', revision: VERSION },
  { url: '/новый-путь.html', revision: VERSION },
  // ... другие файлы ...
];
```

### Изменение версии

Для обновления кэша измените константу `VERSION` в начале файла:

```javascript
const VERSION = "v1.0.1"; // Было "v1.0.0"
```

## Тестирование

Для тестирования service worker:

1. Откройте Chrome DevTools (F12)
2. Перейдите на вкладку Application > Service Workers
3. Проверьте статус service worker
4. Используйте опцию "Offline" в секции Network для тестирования офлайн-режима

## Поиск и устранение проблем

Если возникают проблемы:

1. Проверьте консоль браузера на наличие ошибок
2. В Chrome DevTools > Application > Cache Storage проверьте содержимое кэшей
3. Попробуйте очистить кэши через Chrome DevTools > Application > Clear storage

## Полезные ссылки

- [Официальная документация Workbox](https://developers.google.com/web/tools/workbox)
- [Руководство по стратегиям кэширования](https://developers.google.com/web/tools/workbox/modules/workbox-strategies)
- [Workbox Recipes](https://developers.google.com/web/tools/workbox/modules/workbox-recipes) 