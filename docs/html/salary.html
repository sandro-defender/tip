<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ÉÆ·Éî·Éö·É§·Éê·É°·Éò·É° ·Éô·Éê·Éö·Éô·É£·Éö·Éê·É¢·Éù·É†·Éò</title>
    <style>
        .loading-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(to right, var(--primary, #2a6df5), var(--secondary, #1ac972));
            animation: loading 1.5s infinite linear;
            z-index: 9999;
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .load-error {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: #fee2e2;
            color: #991b1b;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 9999;
            display: none;
        }
    </style>
    <script>
        // Add loading indicator
        document.write('<div class="loading-indicator"></div><div class="load-error">Loading failed. Please refresh.</div>');
        
        // Improved head loading with retry
        function loadHead(retries = 3) {
            return fetch("/includes/head.html")
                .then(response => {
                    if (!response.ok) throw new Error('Failed to load head content');
                    return response.text();
                })
                .then(data => {
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = data;
                    Array.from(tempDiv.children).forEach(element => {
                        if (!document.head.querySelector(`[src="${element.getAttribute('src')}"]`)) {
                            document.head.appendChild(element.cloneNode(true));
                        }
                    });
                })
                .catch(error => {
                    console.error('Head loading error:', error);
                    if (retries > 0) {
                        setTimeout(() => loadHead(retries - 1), 1000);
                    } else {
                        document.querySelector('.load-error').style.display = 'block';
                    }
                });
        }

        // Initialize loading
        loadHead();
    </script>
    <style>
        :root {
            --primary: #2a6df5;
            --secondary: #1ac972;
            --background: #f8faff;
            --text: #2d3748;
            --card-bg: #ffffff;
            --section-bg: #f8f9fe;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0,0,0,0.1);
            --result-bg: linear-gradient(145deg, #2a6df5, #1e4eb2);
            --input-bg: transparent;
            --input-border: #e2e8f0;
            --toggle-bg: white;
            --toggle-shadow: rgba(0,0,0,0.05);
            --toggle-selected-shadow: rgba(42,109,245,0.3);
            --debug-bg: rgba(0, 0, 0, 0.8);
            --debug-text: #00ff00;
            --notice-banner-bg: #ff9800;
            --table-border: rgba(255,255,255,0.2);
            --table-hover: rgba(255,255,255,0.05);
        }

        [data-theme="dark"] {
            --primary: #60a5fa;
            --secondary: #34d399;
            --background: #111827;
            --text: #f3f4f6;
            --card-bg: #1f2937;
            --section-bg: #374151;
            --border-color: #4b5563;
            --shadow-color: rgba(0,0,0,0.5);
            --result-bg: linear-gradient(145deg, #324059, #3c4d74);
            --input-bg: #374151;
            --input-border: #4b5563;
            --toggle-bg: #374151;
            --toggle-shadow: rgba(0,0,0,0.3);
            --toggle-selected-shadow: rgba(96,165,250,0.3);
            --debug-bg: rgba(0, 0, 0, 0.9);
            --debug-text: #00ff00;
            --notice-banner-bg: #f59e0b;
            --table-border: rgba(255,255,255,0.1);
            --table-hover: rgba(255,255,255,0.1);
            --rate-control-bg: #374151;
            --rate-hint-color: #9ca3af;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 1px;
            padding-bottom: 120px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            animation: slideIn 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        .calculator {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 30px var(--shadow-color);
            margin-bottom: 20px;
        }

        .section {
            margin-bottom: 25px;
            padding: 15px;
            background: var(--section-bg);
            border-radius: 15px;
        }

        h2 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
        }

        .toggle-btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: var(--toggle-bg);
            color: var(--text);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px var(--toggle-shadow);
            border: 1px solid var(--border-color);
        }

        .toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px var(--toggle-shadow);
        }

        .toggle-btn.selected {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 15px var(--toggle-selected-shadow);
            border-color: var(--primary);
        }

        .currency-input {
            position: relative;
            z-index: 0;
            width: 100%;
            text-align: center;
            font-size: 1.2rem;
            background: var(--input-bg);
            border: 2px solid var(--input-border);
            border-radius: 12px;
            padding: 12px;
            height: 50px;
            color: var(--text);
            -webkit-tap-highlight-color: transparent;
            transition: all 0.3s ease;
        }

        .currency-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary), 0.2);
        }

        .results {
            background: var(--result-bg);
            color: white;
            border-radius: 20px;
            padding: 3px;
            margin-top: 15px;
            box-shadow: 0 10px 30px var(--shadow-color);
        }

        .results h3 {
            text-align: center;
            margin: 10px 0;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.95);
            border-bottom: 2px solid rgba(255,255,255,0.1);
            padding-bottom: 5px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-bottom: 1px solid var(--table-border);
            font-family: 'SF Pro Display', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
            transition: all 0.3s ease;
            text-align: center;
        }

        .result-item span:first-child {
            font-size: 0.9rem;
            font-weight: 500;
            color: rgba(255,255,255,0.9);
            flex: 1;
            text-align: left;
        }

        .result-item span:not(:first-child) {
            font-family: 'SF Mono', 'Roboto Mono', monospace;
            font-size: 1rem;
            font-weight: 600;
            color: #5ee4ff;
            text-shadow: 0 0 10px rgba(94,228,255,0.3);
            flex: 1;
            text-align: center;
        }

        .result-item:hover {
            background: var(--table-hover);
            border-radius: 10px;
            transform: translateX(5px);
        }

        .result-section {
            margin: 15px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            border: 1px solid var(--table-border);
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .toggle-btn {
                font-size: 0.9rem;
                padding: 10px;
            }
        }

        .notice-banner {
            background: var(--notice-banner-bg);
            color: white;
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-size: 0.9rem;
            box-shadow: 0 2px 10px var(--shadow-color);
        }

        .notice-banner table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .notice-banner td, .notice-banner th {
            padding: 8px;
            border: 1px solid var(--table-border);
            text-align: center;
            font-size: 0.85em;
        }

        .notice-banner tr:hover {
            background: var(--table-hover);
        }

        .rate-control {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
            position: relative;
            touch-action: pan-x;
            user-select: none;
            background: var(--rate-control-bg, #f8f9fe);
            border-radius: 12px;
            padding: 8px;
            border: 1px solid var(--border-color);
        }

        .rate-hint {
            position: absolute;
            bottom: -24px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: var(--rate-hint-color, #666);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .swipe-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .swipe-arrow {
            font-size: 1.2rem;
            animation: swipeHint 2s infinite;
            opacity: 0.6;
        }

        .left-arrow { animation-delay: 0s; }
        .right-arrow { animation-delay: 0.5s; }

        @keyframes swipeHint {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(5px); }
        }

        .rate-control:after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                rgba(42,109,245,0.1) 0%, 
                rgba(255,255,255,0) 20%, 
                rgba(255,255,255,0) 80%, 
                rgba(42,109,245,0.1) 100%);
            pointer-events: none;
            border-radius: 12px;
        }

        .rate-btn {
            position: relative;
            z-index: 2;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .rate-btn:hover {
            background: #1d5bd9;
            transform: scale(1.05);
        }

        .rate-btn:active {
            transform: scale(0.95);
        }

        .debug-window {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--debug-bg);
            color: var(--debug-text);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            max-height: 400px;
            overflow: auto;
            z-index: 1000;
            white-space: pre;
            display: none;
        }

        .debug-toggle {
            position: fixed;
            bottom: 130px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            z-index: 1001;
        }

        @media (max-width: 360px) {
            .result-item {
                font-size: 0.85rem;
            }

            .result-item span:first-child {
                font-size: 0.8rem;
            }

            .result-item span:not(:first-child) {
                font-size: 0.9rem;
            }

            .results h3 {
                font-size: 1rem;
            }

            .result-section {
                padding: 8px;
                margin: 10px 0;
            }

            .container {
                padding: 5px;
            }

            .calculator {
                padding: 15px;
            }
        }

        .collapsible-table {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .collapsible-table.expanded {
            max-height: 500px; /* Adjust this value based on your table height */
        }

        .table-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            width: 100%;
            text-align: left;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-toggle:after {
            content: '‚ñº';
            font-size: 0.8em;
            transform: rotate(-90deg);
            transition: transform 0.3s ease;
        }

        .table-toggle.expanded:after {
            transform: rotate(0);
        }

        .theme-toggle {
            position: fixed;
            top: 38px;
            right: 80px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            box-shadow: 0 4px 15px var(--shadow-color);
            z-index: 1000;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 6px 20px var(--shadow-color);
        }

        [data-theme="dark"] .theme-toggle {
            background: var(--secondary);
            border-color: var(--secondary);
        }

        [data-theme="dark"] .rate-control:after {
            background: linear-gradient(90deg, 
                rgba(96,165,250,0.1) 0%, 
                rgba(0,0,0,0) 20%, 
                rgba(0,0,0,0) 80%, 
                rgba(96,165,250,0.1) 100%);
        }

        [data-theme="dark"] .rate-btn {
            background: var(--primary);
        }

        [data-theme="dark"] .rate-btn:hover {
            background: #3b82f6;
        }

        [data-theme="dark"] .notice-banner {
            background: var(--notice-banner-bg);
        }

        [data-theme="dark"] .notice-banner table {
            background: rgba(0,0,0,0.2);
        }

        [data-theme="dark"] .result-section {
            background: rgba(0,0,0,0.3);
        }

        [data-theme="dark"] .result-item {
            border-bottom-color: var(--table-border);
        }

        [data-theme="dark"] .result-item:hover {
            background: var(--table-hover);
        }

        [data-theme="dark"] .currency-input {
            background: var(--input-bg);
            color: var(--text);
            border-color: var(--input-border);
        }

        [data-theme="dark"] .currency-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(96,165,250,0.2);
        }

        [data-theme="dark"] .toggle-btn {
            background: var(--toggle-bg);
            color: var(--text);
            border-color: var(--border-color);
        }

        [data-theme="dark"] .toggle-btn:hover {
            background: var(--section-bg);
        }

        [data-theme="dark"] .toggle-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        #bottom-results-bar {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 5px 10px;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            z-index: 999;
            transition: all 0.3s ease;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }

        [data-theme="dark"] #bottom-results-bar {
            background: rgba(17, 24, 39, 0.75);
            box-shadow: 0 -2px 10px rgba(0,0,0,0.2);
        }

        .bottom-result-item {
            text-align: center;
            color: var(--text);
        }

        .bottom-result-item span {
            font-size: 0.75rem;
            opacity: 0.8;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .bottom-result-item strong {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <div id="menu-container"></div>
    <div class="container">
        <!--<button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">üåô</button>-->

    
        <div class="calculator">
            <!-- ·É°·Éê·Éõ·É£·É®·Éê·Éù ·Éì·É¶·Éî·Éî·Éë·Éò -->
            <div class="section">
                <h2>üìÖ ·É°·Éê·Éõ·É£·É®·Éê·Éù ·Éì·É¶·Éî·Éî·Éë·Éò</h2>
                <div class="button-grid">
                    <button class="toggle-btn" data-days="13">13 ·Éì·É¶·Éî</button>
                    <button class="toggle-btn" data-days="14">14 ·Éì·É¶·Éî</button>
                    <button class="toggle-btn selected" data-days="15">15 ·Éì·É¶·Éî</button>
                    <button class="toggle-btn" data-days="16">16 ·Éì·É¶·Éî</button>
                </div>
            </div>

            <!-- ·Éû·Éù·Éñ·Éò·É™·Éò·Éê -->
            <div class="section">
                <h2>üßë‚Äçüßë‚Äçüßí‚Äçüßí ·Éû·Éù·Éñ·Éò·É™·Éò·Éê</h2>
                <div class="button-grid">
                    <button class="toggle-btn" data-position="tr">TR</button>
                    <button class="toggle-btn" data-position="d3">D3</button>
                    <button class="toggle-btn" data-position="d2">D2</button>
                    <button class="toggle-btn" data-position="d1">D1</button>
                    <button class="toggle-btn selected" data-position="i2">I2</button>
                    <button class="toggle-btn" data-position="i1">I1</button>
                    <button class="toggle-btn" data-position="ti">IT</button>
                </div>
            </div>

            <!-- ·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éò·Éó·Éò ·É°·Éõ·Éî·Éú·Éî·Éë·Éò ·Éì·Éê ·Éí·Éê·É™·Éì·Éî·Éú·Éî·Éë·Éò ·Éõ·Éù·Éì·Éê·Éö·Éò·Éó -->
            <div class="section">
                 <button id="openShiftModal" class="toggle-btn" style="width:100%;font-size:1.1rem;">‚ûï  ·É°·Éõ·Éî·Éú·Éî·Éë·Éò / ·Éí·Éê·É™·Éì·Éî·Éú·Éî·Éë·Éò ‚ûñ</button>
                 <div style="margin-top:10px;text-align:center;">
                   <span id="shiftSummary">·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éò·Éó·Éò ·É°·Éõ·Éî·Éú·Éî·Éë·Éò: 0 | ·Éí·Éê·É™·Éì·Éî·Éú·Éî·Éë·Éò: 0</span>
                </div>
            </div>

            <!-- ·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éò·Éó·Éò ·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò -->
            <div class="section">
                <h2>‚öôÔ∏è ·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò</h2>
                <div class="button-grid">
                    <button class="toggle-btn" data-option="vacation">üèñÔ∏è ·É®·Éï·Éî·Éë·É£·Éö·Éî·Éë·Éê</button>
                    <button class="toggle-btn selected" data-option="pension">üìà ·Éû·Éî·Éú·É°·Éò·Éê (2%)</button>
                </div>
                <!-- Add insurance input after buttons -->
                <div class="rate-control" style="margin-bottom: 15px; justify-content: space-between;">
                    <span style="padding: 10px;">üè• ·Éì·Éê·Éñ·É¶·Éï·Éî·Éï·Éê (‚Çæ):</span>
                    <input type="number" class="currency-input" id="insuranceAmount" value="0" step="1" min="0" style="text-align: center; width: 130px;" placeholder="·Éì·Éê·Éñ·É¶·Éï·Éî·Éï·Éò·É° ·Éó·Éê·Éú·ÉÆ·Éê">
                </div>
                <!-- Add tip amount input -->
                <div class="rate-control" style="margin-bottom: 15px; justify-content: space-between;">
                    <span style="padding: 10px;">üéÅ Tip ·É§·Éù·Éò·Éú·É¢·Éñ·Éî:</span>
                    <input type="number" class="currency-input" id="tipAmount" value="0" step="0.1" min="0" style="text-align: center; width: 130px;" placeholder="·É©·Éê·Éò·É° ·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê">
                </div>
                <div class="rate-control">
                    <button class="rate-btn" onclick="calculator.adjustRate(-0.01)">-</button>
                    <input type="number" class="currency-input" id="exchangeRate" value="2.800" step="0.01" min="0" placeholder="USD/GEL ·Éô·É£·É†·É°·Éò">
                    <button class="rate-btn" onclick="calculator.adjustRate(0.01)">+</button>
                </div>
            </div>

            <!-- ·É®·Éî·Éì·Éî·Éí·Éî·Éë·Éò -->
            <div class="results">
                <div class="result-section">
                    <h3>üí∞ ·ÉÆ·Éî·Éö·É§·Éê·É°·Éò</h3>
                    <div class="result-item">
                        <span>·Éì·É¶·Éî/·É°·Éó:</span>
                        <span id="totalDays">0</span>
                        <span id="totalHours">0 ·É°·Éó</span>
                    </div>
                    <div class="result-item">
                        <span>·ÉØ·Éê·Éõ·Éò:</span>
                        <span id="totalSalary">$0.00</span>
                        <span id="totalGelSalary">‚Çæ0.00</span>
                    </div>
                    <!-- ·Éê·ÉÆ·Éê·Éö·Éò ·Éí·É†·Éê·É§·Éê ·É™·Éï·Éö·Éò·Éö·Éî·Éë·Éò·É°·Éó·Éï·Éò·É° -->
                    <div id="salaryDiffRow" style="display: none;" class="result-item">
                        <span>·É™·Éï·Éö·Éò·Éö·Éî·Éë·Éê:</span>
                        <span id="salaryDiffUSD">$0.00</span>
                        <span id="salaryDiffGEL">‚Çæ0.00</span>
                    </div>
                    <div class="result-item">
                        <span>·Éì·É¶·Éí:</span>
                        <span id="taxAmount">$0.00</span>
                        <span id="taxAmountGel">‚Çæ0.00</span>
                    </div>
                    <div class="result-item">
                        <span>·Éû·Éî·Éú·É°·Éò·Éê:</span>
                        <span id="PensionAmount">$0.00</span>
                        <span id="PensionAmountGel">‚Çæ0.00</span>
                    </div>
                    <div class="result-item">
                        <span>·Éê·É°·Éê·É¶·Éî·Éë·Éò:</span>
                        <span id="netSalaryUSD">$0.00</span>
                        <span id="netSalary">‚Çæ0.00</span>
                    </div>
                </div>
                
                <div class="result-section">
                    <h3>üéÅ ·É©·Éê·Éò</h3>
                    <div class="result-item">
                        <span>·ÉØ·Éê·Éõ·Éò:</span>
                        <span id="tipAmountUSD">$0.00</span>
                        <span id="tipAmountGel">‚Çæ0.00</span>
                    </div>
                    <!-- ·Éê·ÉÆ·Éê·Éö·Éò ·Éí·É†·Éê·É§·Éê ·É™·Éï·Éö·Éò·Éö·Éî·Éë·Éò·É°·Éó·Éï·Éò·É° -->
                    <div id="tipDiffRow" style="display: none;" class="result-item">
                        <span>·É™·Éï·Éö·Éò·Éö·Éî·Éë·Éê:</span>
                        <span id="tipDiffUSD">$0.00</span>
                        <span id="tipDiffGEL">‚Çæ0.00</span>
                    </div>
                    <div class="result-item">
                        <span>·Éì·É¶·Éí:</span>
                        <span id="tipTaxUSD">$0.00</span>
                        <span id="tipTaxGel">‚Çæ0.00</span>
                    </div>
                    <div class="result-item">
                        <span>·Éû·Éî·Éú·É°·Éò·Éê:</span>
                        <span id="tipPensionUSD">$0.00</span>
                        <span id="tipPensionGel">‚Çæ0.00</span>
                    </div>
                    <div class="result-item">
                        <span>·Éê·É°·Éê·É¶·Éî·Éë·Éò:</span>
                        <span id="grandTotalUSD">$0.00</span>
                        <span id="grandTotalGel">‚Çæ0.00</span>
                    </div>
                </div>
                <div class="result-section">
                    <h3>·ÉØ·Éê·Éõ·Éò</h3>
                    <div class="result-item">
                        <span>·ÉØ·Éê·Éõ·Éò:</span>
                        <span id="BothTotalUSD">$0.00</span>
                        <span id="BothTotalGel">‚Çæ0.00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="bottom-results-bar">
        <div class="bottom-result-item">
            <span>·ÉÆ·Éî·Éö·É§·Éê·É°·Éò (·ÉÆ·Éî·Éö·Éñ·Éî)</span>
            <strong id="bottom-salary-gel">‚Çæ0.00</strong>
        </div>
        <div class="bottom-result-item">
            <span>·É©·Éê·Éò (·ÉÆ·Éî·Éö·Éñ·Éî)</span>
            <strong id="bottom-tip-gel">‚Çæ0.00</strong>
        </div>
        <div class="bottom-result-item">
            <span>·É°·É£·Éö ·ÉØ·Éê·Éõ·Éò</span>
            <strong id="bottom-total-gel">‚Çæ0.00</strong>
        </div>
    </div>

    <button class="debug-toggle" onclick="toggleDebug()">üêû</button>
    <div class="debug-window" id="debugWindow"></div>

    <!-- Shift/Missed Modal -->
    <div id="shiftModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:2000;align-items:center;justify-content:center;">
      <div class="shift-modal-content">
        <button id="closeShiftModal" style="position:absolute;top:10px;right:10px;background:none;border:none;font-size:1.5rem;cursor:pointer;color:var(--text);">√ó</button>
        <h2 style="margin-bottom:10px;font-size:1.2rem;color:var(--primary);">‚ûï ·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éò·Éó·Éò ·É°·Éõ·Éî·Éú·Éî·Éë·Éò</h2>
        <div class="button-grid" id="modalShiftsGrid" style="margin-bottom:18px;">
          <button class="toggle-btn" data-shifts="0">0</button>
          <button class="toggle-btn" data-shifts="1">1</button>
          <button class="toggle-btn" data-shifts="2">2</button>
          <button class="toggle-btn" data-shifts="3">3</button>
          <button class="toggle-btn" data-shifts="4">4</button>
          <button class="toggle-btn" data-shifts="5">5</button>
          <button class="toggle-btn" data-shifts="6">6</button>
        </div>
        <h2 style="margin-bottom:10px;font-size:1.2rem;color:var(--primary);">‚ûñ ·Éí·Éê·É™·Éì·Éî·Éú·Éî·Éë·Éò</h2>
        <div class="button-grid" id="modalMissedGrid">
          <button class="toggle-btn" data-missed="0">0</button>
          <button class="toggle-btn" data-missed="1">1</button>
          <button class="toggle-btn" data-missed="2">2</button>
          <button class="toggle-btn" data-missed="3">3</button>
          <button class="toggle-btn" data-missed="4">4</button>
          <button class="toggle-btn" data-missed="5">5</button>
        </div>
      </div>
    </div>
    <style>
      #shiftModal {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.35);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }
      .shift-modal-content {
        background: rgba(255, 255, 255, 0.2); /* Glass effect */
        color: var(--text);
        max-width: 340px;
        width: 90vw;
        padding: 24px 18px 18px 18px;
        border-radius: 16px;
        box-shadow: 0 4px 30px rgba(0,0,0,0.1);
        position: relative;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      #shiftModal .toggle-btn.selected {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }
      #shiftModal .toggle-btn {
        background: var(--toggle-bg);
        color: var(--text);
        border: 1px solid var(--border-color);
      }
      #shiftModal #closeShiftModal {
        color: var(--text);
      }
      [data-theme="dark"] #shiftModal {
        background: rgba(0,0,0,0.65);
      }
      [data-theme="dark"] .shift-modal-content {
        background: rgba(20, 30, 45, 0.25); /* Dark glass effect */
        border-color: rgba(255, 255, 255, 0.18);
      }
    </style>

    <script>
        //---> ·Éõ·Éî·Éú·Éò·É£·É° ·É©·Éê·É¢·Éï·Éò·É†·Éó·Éï·Éê
        fetch('/includes/menu-1.2.html')
            .then(response => response.text())
            .then(data => {
                console.log('Menu HTML loaded, inserting into DOM...');
                document.getElementById('menu-container').innerHTML = data;
                console.log('Menu HTML inserted, executing scripts...');
                
                // Execute any script tags that were inserted
                const scripts = document.getElementById('menu-container').querySelectorAll('script');
                scripts.forEach(script => {
                    if (script.textContent) {
                        console.log('Executing script from menu...');
                        eval(script.textContent);
                    }
                });
                
                // Wait for the script to execute and function to be available
                let attempts = 0;
                const maxAttempts = 20; // Reduced to 2 seconds since we're executing scripts immediately
                
                const waitForInit = () => {
                    attempts++;
                    console.log(`Attempt ${attempts}: Checking for initBottomNav function...`);
                    
                    if (typeof window.initBottomNav === 'function') {
                        console.log('initBottomNav function found! Calling it...');
                        window.initBottomNav();
                        console.log('Bottom navigation initialized successfully');
                    } else if (attempts < maxAttempts) {
                        console.log('Function not found yet, retrying...');
                        setTimeout(waitForInit, 100);
                    } else {
                        console.error('initBottomNav function not found after 2 seconds. Available functions:', Object.keys(window).filter(key => typeof window[key] === 'function'));
                    }
                };
                
                // Start waiting for the function to be available
                setTimeout(waitForInit, 50); // Reduced delay since scripts are executed immediately
            })
            .catch(error => console.error('Error loading menu:', error));

            // <--- ·Éõ·Éî·Éú·Éò·É£·É° ·É©·Éê·É¢·Éï·Éò·É†·Éó·Éï·Éê



        // Hide loading indicator when everything is loaded
        window.addEventListener('load', () => {
            document.querySelector('.loading-indicator').style.display = 'none';
        });

        // Show error if loading fails
        window.addEventListener('error', () => {
            document.querySelector('.loading-indicator').style.display = 'none';
            document.querySelector('.load-error').style.display = 'block';
        });

        // Global configuration
        const CONFIG = {
            // Base rates for positions ($ per 174 hours)
            RATES: {
                'tr': 525,
                'd3': 525,
                'd2': 630,
                'd1': 735,
                'i2': 840,
                'i1': 945,
                'ti': 1050
            },
            
            // Convert monthly rates to hourly rates
            getRatePerHour: function(position) {
                return this.RATES[position] / 174;
            },
            
            // Tip multipliers per position
            TIP_MULTIPLIERS: {
                'point': 1,
                'tr': 7,
                'd3': 9,
                'd2': 10,
                'd1': 11,
                'pb': 12,
                'i2': 14.5,
                'i1': 16,
                'ti': 17.5
            },

            // Working hours
            REGULAR_HOURS: 12,
            EXTRA_SHIFT_HOURS: 18,
            VACATION_BASE_DAYS: 14.5,
            
            // Deduction rates
            PENSION_RATE: 0.02,
            
            // Exchange rate default
            DEFAULT_EXCHANGE_RATE: 2.80,
            
            // Tax rate (e.g., 20%)
            TAX_RATE: 0.20,

            // Change EXTRA_SHIFT_TIP_BONUS to be calculated from tip amount
            EXTRA_SHIFT_TIP_MULTIPLIER: 0.5,

            // Tip adjustment formula constants
            TIP_ADJUSTMENT_DIVISOR: 0.78,
            
            // Formula helper function
            adjustTipAmount: function(x) {
                return x / this.TIP_ADJUSTMENT_DIVISOR;
            },

            // Default insurance amount
            INSURANCE_DEFAULT: 0,

            // --- Dev/Admin Settings ---
            // Set to true to show the debug button and window
            DEBUG_MODE: false
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞ USD/GEL –∏–∑ API
        async function getRateFromNBG() {
            try {
                const response = await fetch("https://nbg.gov.ge/gw/api/ct/monetarypolicy/currencies/en/json");
                const data = await response.json();
                console.log('–ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –æ—Ç NBG:', data);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                if (Array.isArray(data) && data.length > 0) {
                    // –ü–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: –º–∞—Å—Å–∏–≤ —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ code –∏ currencies
                    if (data[0] && typeof data[0] === 'object') {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–æ—Ä–º–∞—Ç–∞
                        const usd = data.find(item => item.code === "USD");
                        if (usd && usd.currencies && Array.isArray(usd.currencies) && usd.currencies.length > 0) {
                            const rate = usd.currencies[0].rate;
                            console.log('–ü–æ–ª—É—á–µ–Ω –∫—É—Ä—Å –æ–±–º–µ–Ω–∞ USD/GEL –∏–∑ NBG (—Ñ–æ—Ä–º–∞—Ç 1):', rate);
                            return rate;
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ç–æ—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–æ—Ä–º–∞—Ç–∞, –≥–¥–µ USD –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ currencies
                        for (const item of data) {
                            if (item.currencies && Array.isArray(item.currencies)) {
                                const usdCurrency = item.currencies.find(curr => curr.code === "USD");
                                if (usdCurrency && usdCurrency.rate) {
                                    console.log('–ü–æ–ª—É—á–µ–Ω –∫—É—Ä—Å –æ–±–º–µ–Ω–∞ USD/GEL –∏–∑ NBG (—Ñ–æ—Ä–º–∞—Ç 2):', usdCurrency.rate);
                                    return usdCurrency.rate;
                                }
                            }
                        }
                    }
                }
                
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫—É—Ä—Å USD –≤ –¥–∞–Ω–Ω—ã—Ö NBG:', data);
                return null;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∫—É—Ä—Å–∞ –æ–±–º–µ–Ω–∞ –∏–∑ NBG:', error);
                return null;
            }
        }

        const calculator = {
            days: 15,
            rate: CONFIG.getRatePerHour('i2'), // Default to i2 position
            shifts: 0,
            missedDays: 0,
            options: new Set(['pension']),
            exchangeRate: parseFloat(localStorage.getItem('exchangeRate')) || CONFIG.DEFAULT_EXCHANGE_RATE,
            tipPoints: parseFloat(localStorage.getItem('tipPoints')) || 0,
            position: 'i2', // Default position
            insuranceAmount: parseFloat(localStorage.getItem('insuranceAmount')) || CONFIG.INSURANCE_DEFAULT,
            
            async init() {
                console.log('Initializing calculator...');

                // Hide debug button if debug mode is disabled
                if (!CONFIG.DEBUG_MODE) {
                    const debugToggle = document.querySelector('.debug-toggle');
                    if (debugToggle) {
                        debugToggle.style.display = 'none';
                    }
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –≤–∞–ª—é—Ç—ã –∏–∑ API NBG
                const liveRate = await getRateFromNBG();
                if (liveRate) {
                    this.exchangeRate = liveRate;
                    localStorage.setItem('exchangeRate', this.exchangeRate);
                    console.log('–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∫—É—Ä—Å –æ–±–º–µ–Ω–∞ –∏–∑ API NBG:', this.exchangeRate);
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ –∏–∑ API —Å 4 –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
                    document.getElementById('exchangeRate').value = this.exchangeRate.toFixed(4);
                } else {
                    console.log('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∏–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∫—É—Ä—Å –æ–±–º–µ–Ω–∞:', this.exchangeRate);
                    // –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤
                    document.getElementById('exchangeRate').value = this.exchangeRate.toFixed(2);
                }
                
                // Set default values
                document.getElementById('insuranceAmount').value = this.insuranceAmount;
                document.getElementById('tipAmount').value = this.tipPoints;
                
                // Process URL parameters
                const params = new URLSearchParams(window.location.search);
                if (params.has('tipAmount') && params.has('position')) {
                    const position = params.get('position').toLowerCase();
                    if (CONFIG.RATES[position]) {
                        this.position = position;
                        this.rate = CONFIG.getRatePerHour(position);
                        this.tipPoints = parseFloat(params.get('tipAmount')) || 0;
                        document.getElementById('tipAmount').value = this.tipPoints;
                        
                        // Select position button
                        this.selectPositionButton(position);
                        console.log(`Set from URL: position=${position}, rate=${this.rate}, tips=${this.tipPoints}`);
                    }
                }

                this.initEventListeners();
                this.calculate();
            },

            selectPositionButton(position) {
                document.querySelectorAll('[data-position]').forEach(btn => {
                    btn.classList.toggle('selected', btn.dataset.position.toLowerCase() === position);
                });
            },

            initEventListeners() {
                document.querySelectorAll('.toggle-btn').forEach(btn => {
                    btn.addEventListener('click', () => this.handleToggle(btn));
                });

                const exchangeRateInput = document.getElementById('exchangeRate');
                exchangeRateInput.addEventListener('input', (e) => {
                    this.exchangeRate = parseFloat(e.target.value) || CONFIG.DEFAULT_EXCHANGE_RATE;
                    // Save to localStorage on manual input
                    localStorage.setItem('exchangeRate', this.exchangeRate);
                    this.calculate();
                });

                const insuranceInput = document.getElementById('insuranceAmount');
                insuranceInput.addEventListener('input', (e) => {
                    this.insuranceAmount = parseFloat(e.target.value) || 0;
                    localStorage.setItem('insuranceAmount', this.insuranceAmount);
                    this.calculate();
                });

                // Add event listener for tip amount input
                const tipAmountInput = document.getElementById('tipAmount');
                tipAmountInput.addEventListener('input', (e) => {
                    this.tipPoints = parseFloat(e.target.value) || 0;
                    localStorage.setItem('tipPoints', this.tipPoints);
                    this.calculate();
                });
            },

            adjustRate(amount) {
                const input = document.getElementById('exchangeRate');
                const newValue = (parseFloat(input.value) + amount).toFixed(2);
                input.value = newValue;
                this.exchangeRate = parseFloat(newValue);
                // Save to localStorage whenever rate changes
                localStorage.setItem('exchangeRate', this.exchangeRate);
                this.calculate();
            },

            handleToggle(btn) {
                const type = btn.dataset.days ? 'days' :
                            btn.dataset.position ? 'rate' :
                            btn.dataset.shifts ? 'shifts' :
                            btn.dataset.missed ? 'missed' : 'option';

                if (type === 'option') {
                    btn.classList.toggle('selected');
                    this.options[btn.classList.contains('selected') ? 'add' : 'delete'](btn.dataset.option);
                } else {
                    const selector = `[data-${type === 'rate' ? 'position' : type}]`;
                    document.querySelectorAll(selector).forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    
                    switch(type) {
                        case 'rate':
                            const pos = btn.dataset.position.toLowerCase();
                            if (CONFIG.RATES[pos]) {
                                this.position = pos;
                                this.rate = CONFIG.getRatePerHour(pos);
                                console.log(`Position changed: ${this.position}, rate: ${this.rate}`);
                            }
                            break;
                        case 'days':
                            this.days = parseFloat(btn.dataset.days);
                            break;
                        case 'shifts':
                            this.shifts = parseFloat(btn.dataset.shifts);
                            break;
                        case 'missed':
                            this.missedDays = parseFloat(btn.dataset.missed);
                            break;
                    }
                }

                this.calculate();
            },

            updateDebug(calculations) {
                const debugWindow = document.getElementById('debugWindow');
                const {
                    hours = 0,
                    baseHours = 0,
                    extraHours = 0,
                    missedHours = 0,
                    baseSalary = 0,
                    extraSalary = 0,
                    missedSalary = 0,
                    totalSalary = 0,
                    grossTips = 0,
                    tipDiff = 0,
                    tipTax = 0,
                    tipPension = 0,
                    netTips = 0
                } = calculations || {};

                // Format money with colors
                const formatMoney = (amount, symbol = '$') => 
                    `${amount >= 0 ? 'üíµ' : 'üí∏'} ${symbol}${Math.abs(amount).toFixed(2)}`;
                
                const formatPercent = (amount, total) => 
                    total ? ` (${((amount/total)*100).toFixed(1)}%)` : '';

                const insuranceUSD = this.insuranceAmount / this.exchangeRate;

                let debugText = `
üîç Debug Information
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
·ÉÆ·Éî·Éö·É§·Éê·É°·Éò 14.5 ·Éì·É¶·Éò·É°·Éó·Éï·Éò·É° 174·É°·Éó
·Éû·Éù·Éñ.   ·ÉÆ·Éî·Éö·É§·Éê·É°·Éò.   -2%.  ·É°·Éê·Éê·Éó·É®·Éò
D3	525	514.5	2.9586
D2	630	617.4	3.5483
D1	735	720.3	4.1414
I2	840	823.2	4.7333
I1	945	926.1	5.3236
Ti	1050	1029	5.9138
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üë§ Position Settings
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìã Position: ${this.position.toUpperCase()}
üí∞ Rate: ${formatMoney(this.rate)}/hr
üìÖ Working Days: ${this.days}
‚ûï Extra Shifts: ${this.shifts}
‚ûñ Missed Days: ${this.missedDays}
üí± Exchange Rate: ${this.exchangeRate} GEL
üéØ Tip Points: ${this.tipPoints}
‚öôÔ∏è Options: ${Array.from(this.options).join(', ')}

‚è∞ Hours Breakdown
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üìä Base Hours: ${baseHours} (${this.days} days √ó ${CONFIG.REGULAR_HOURS}hrs)
üìà Extra Hours: ${extraHours} (${this.shifts} shifts √ó ${CONFIG.EXTRA_SHIFT_HOURS}hrs)
üìâ Missed Hours: ${missedHours}
üìã Total Hours: ${hours}

üí∞ Salary Details
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üíµ Base Salary: ${formatMoney(baseSalary)}
${extraSalary ? `üìà Extra Pay: ${formatMoney(extraSalary)}${formatPercent(extraSalary, totalSalary)}\n` : ''}
${missedSalary ? `üìâ Deductions: ${formatMoney(-missedSalary)}${formatPercent(missedSalary, totalSalary)}\n` : ''}
üí∞ Total Salary: ${formatMoney(totalSalary)} / ${formatMoney(totalSalary * this.exchangeRate, '‚Çæ')}

üéÅ Tips Calculation
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üí∞ Base Tips: ${formatMoney(grossTips)}
${tipDiff ? `${tipDiff > 0 ? 'üìà' : 'üìâ'} Tip Adjustment: ${formatMoney(tipDiff)}\n` : ''}
${tipTax ? `üìã Tax (20%): ${formatMoney(-tipTax)}\n` : ''}
${tipPension ? `üìã Pension (2%): ${formatMoney(-tipPension)}\n` : ''}
üíµ Net Tips: ${formatMoney(netTips)} / ${formatMoney(netTips * this.exchangeRate, '‚Çæ')}

üíµ Final Summary
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Total Take Home: ${formatMoney(netTips + (totalSalary - (this.options.has('tax') ? totalSalary * CONFIG.TAX_RATE : 0) - (this.options.has('pension') ? totalSalary * CONFIG.PENSION_RATE : 0) - insuranceUSD))}
In GEL: ${formatMoney((netTips + (totalSalary - (this.options.has('tax') ? totalSalary * CONFIG.TAX_RATE : 0) - (this.options.has('pension') ? totalSalary * CONFIG.PENSION_RATE : 0) - insuranceUSD)) * this.exchangeRate, '‚Çæ')}
üíä Insurance: ‚Çæ${this.insuranceAmount.toFixed(2)} / $${insuranceUSD.toFixed(2)}
`;

                debugWindow.style.whiteSpace = 'pre-wrap';
                debugWindow.style.fontFamily = 'monospace';
                debugWindow.style.fontSize = '14px';
                debugWindow.style.lineHeight = '1.5';
                debugWindow.textContent = debugText;
            },

            calculate() {
                try {
                    if (!this.position || !CONFIG.RATES[this.position]) {
                        throw new Error('Position or rate not set');
                    }

                    // Get hourly rate for position
                    this.rate = CONFIG.getRatePerHour(this.position);

                    // Calculate the effective difference between missed days and extra shifts
                    const effectiveMissedDays = Math.max(0, this.missedDays - this.shifts);
                    const effectiveShifts = Math.max(0, this.shifts - this.missedDays);

                    // Rest of calculation logic
                    const baseHours = this.options.has('vacation') ? 
                        CONFIG.VACATION_BASE_DAYS * CONFIG.REGULAR_HOURS :
                        this.days * CONFIG.REGULAR_HOURS;
                    
                    const extraHours = effectiveShifts * CONFIG.EXTRA_SHIFT_HOURS;
                    const missedHours = effectiveMissedDays * CONFIG.REGULAR_HOURS;
                    const totalHours = baseHours + extraHours - missedHours;

                    // Salary calculations
                    const baseSalary = baseHours * this.rate;
                    const extraSalary = extraHours * this.rate;
                    const missedSalary = missedHours * this.rate;
                    const totalSalary = baseSalary + extraSalary - missedSalary;

                    // Tips calculation
                    let baseTipAmount = this.tipPoints;
                    let positionMultiplier = CONFIG.TIP_MULTIPLIERS[this.position] || 1;
                    let grossTips = baseTipAmount * positionMultiplier;
                    let tipDiff = 0;

                    // Only calculate tip adjustments based on effective differences
                    if (effectiveShifts > 0) {
                        const shiftBonus = baseTipAmount * CONFIG.EXTRA_SHIFT_TIP_MULTIPLIER * effectiveShifts;
                        grossTips += shiftBonus;
                        tipDiff = shiftBonus;
                    } else if (effectiveMissedDays > 0) {
                        const missedAmount = (grossTips / this.days) * (effectiveMissedDays * 1.5);
                        grossTips -= missedAmount;
                        tipDiff = -missedAmount;
                    }

                    // Calculate tax amount that was originally deducted (20%)
                    const originalTaxAmount = grossTips * CONFIG.TAX_RATE;
                    
                    // Calculate pension on the original amount
                    const pensionAmount = grossTips * CONFIG.PENSION_RATE;

                    // Calculate final tips
                    let finalTips = grossTips;
                    
                    // Only handle pension deduction
                    if (this.options.has('pension')) {
                        finalTips -= pensionAmount;
                    }

                    this.updateUI({
                        hours: totalHours,
                        baseHours,
                        extraHours,
                        missedHours,
                        baseSalary,
                        extraSalary,
                        missedSalary,
                        totalSalary,
                        grossTips: finalTips,
                        tipDiff,
                        tipTax: originalTaxAmount,
                        tipPension: this.options.has('pension') ? pensionAmount : 0,
                        netTips: finalTips  // Remove the extra pension deduction here
                    });

                } catch (error) {
                    console.error('Calculation error:', error);
                    this.showError('Calculation failed: ' + error.message);
                }
            },

            showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position:fixed;top:10px;left:50%;transform:translateX(-50%);background:red;color:white;padding:10px;border-radius:5px;z-index:1000;';
                errorDiv.textContent = message;
                document.body.appendChild(errorDiv);
                setTimeout(() => errorDiv.remove(), 3000);
            },

            updateUI(calculations) {
                // Destructure all needed values
                const { 
                    hours, baseHours, extraHours, missedHours,
                    baseSalary, extraSalary, missedSalary, totalSalary,
                    grossTips, tipDiff, tipTax, tipPension, netTips 
                } = calculations;

                // Update debug info first to ensure all values are passed correctly
                this.updateDebug(calculations);

                // Update hours display
                document.getElementById('totalHours').textContent = hours;
                document.getElementById('totalDays').textContent = (hours / CONFIG.REGULAR_HOURS).toFixed(1);

                // Update base amounts
                document.getElementById('totalSalary').textContent = `$${totalSalary.toFixed(1)}`;
                document.getElementById('totalGelSalary').textContent = `‚Çæ${(totalSalary * this.exchangeRate).toFixed(1)}`;

                // Update salary section with 20% already deducted tax
                const baseTax = totalSalary * 0.2; // Changed from CONFIG.TAX_RATE to direct 0.2 for 20%
                const salaryPension = totalSalary * CONFIG.PENSION_RATE;
                const insuranceUSD = this.insuranceAmount / this.exchangeRate;
                const deductions = (this.options.has('pension') ? salaryPension : 0);
                const netSalaryUSD = totalSalary - deductions - insuranceUSD;
                const netSalaryGEL = netSalaryUSD * this.exchangeRate;

                document.getElementById('netSalaryUSD').textContent = `$${netSalaryUSD.toFixed(1)}`;
                document.getElementById('netSalary').textContent = `‚Çæ${netSalaryGEL.toFixed(1)}`;
                document.getElementById('taxAmount').textContent = `-$${(totalSalary * CONFIG.TAX_RATE).toFixed(1)}`; // Show original deducted amount
                document.getElementById('taxAmountGel').textContent = `-‚Çæ${(totalSalary * CONFIG.TAX_RATE * this.exchangeRate).toFixed(1)}`;
                document.getElementById('PensionAmount').textContent = `-$${this.options.has('pension') ? salaryPension.toFixed(1) : '0.0'}`;
                document.getElementById('PensionAmountGel').textContent = `-‚Çæ${this.options.has('pension') ? (salaryPension * this.exchangeRate).toFixed(1) : '0.0'}`;

                // Update tips section - show original 20% tax that was deducted
                const originalTipTax = (grossTips + tipPension) * CONFIG.TAX_RATE; // 20% of gross tip amount
                document.getElementById('tipAmountUSD').textContent = `$${(grossTips + tipPension).toFixed(1)}`;
                document.getElementById('tipAmountGel').textContent = `‚Çæ${((grossTips + tipPension) * this.exchangeRate).toFixed(1)}`;
                
                document.getElementById('tipTaxUSD').textContent = `-$${originalTipTax.toFixed(1)}`;
                document.getElementById('tipTaxGel').textContent = `-‚Çæ${(originalTipTax * this.exchangeRate).toFixed(1)}`;
                
                document.getElementById('tipPensionUSD').textContent = `-$${tipPension.toFixed(1)}`;
                document.getElementById('tipPensionGel').textContent = `-‚Çæ${(tipPension * this.exchangeRate).toFixed(1)}`;
                
                // Show net tips (after pension deduction) in the grand total
                document.getElementById('grandTotalUSD').textContent = `$${grossTips.toFixed(1)}`;
                document.getElementById('grandTotalGel').textContent = `‚Çæ${(grossTips * this.exchangeRate).toFixed(1)}`;

                // Calculate final total with gross tips but net salary
                document.getElementById('BothTotalUSD').textContent = `$${(grossTips + netSalaryUSD).toFixed(1)}`;
                document.getElementById('BothTotalGel').textContent = `‚Çæ${((grossTips * this.exchangeRate) + netSalaryGEL).toFixed(1)}`;

                // Update bottom results bar
                document.getElementById('bottom-salary-gel').textContent = `‚Çæ${netSalaryGEL.toFixed(1)}`;
                const grandTotalGEL = (grossTips * this.exchangeRate);
                document.getElementById('bottom-tip-gel').textContent = `‚Çæ${grandTotalGEL.toFixed(1)}`;
                document.getElementById('bottom-total-gel').textContent = `‚Çæ${(grandTotalGEL + netSalaryGEL).toFixed(1)}`;

                // Update differences display
                const salaryDiffRow = document.getElementById('salaryDiffRow');
                const tipDiffRow = document.getElementById('tipDiffRow');

                if (this.shifts > 0 || this.missedDays > 0) {
                    if (tipDiff !== 0) {
                        tipDiffRow.style.display = 'flex';
                        const sign = tipDiff > 0 ? '+' : '-';
                        document.getElementById('tipDiffUSD').textContent = `${sign}$${Math.abs(tipDiff).toFixed(1)}`;
                        document.getElementById('tipDiffGEL').textContent = `${sign}‚Çæ${Math.abs(tipDiff * this.exchangeRate).toFixed(1)}`;
                    } else {
                        tipDiffRow.style.display = 'none';
                    }
                } else {
                    salaryDiffRow.style.display = 'none';
                    tipDiffRow.style.display = 'none';
                }
            }
        };

        // Add debug toggle function
        function toggleDebug() {
            const debugWindow = document.getElementById('debugWindow');
            debugWindow.style.display = debugWindow.style.display === 'none' ? 'block' : 'none';
        }

        // Initialize calculator
        (async function() {
            await calculator.init();
        })();
        
        function toggleTable(button) {
            const table = button.nextElementSibling;
            button.classList.toggle('expanded');
            table.classList.toggle('expanded');
        }

        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            const icon = document.getElementById('theme-toggle');
            if (icon) {
                icon.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            }
        }

        // Initialize theme on page load
        initTheme();

        // Add modal logic for shifts/missed
        document.getElementById('openShiftModal').onclick = function() {
          document.getElementById('shiftModal').style.display = 'flex';
          // Highlight current selection
          Array.from(document.querySelectorAll('#modalShiftsGrid .toggle-btn')).forEach(btn => {
            btn.classList.toggle('selected', parseInt(btn.dataset.shifts) === calculator.shifts);
          });
          Array.from(document.querySelectorAll('#modalMissedGrid .toggle-btn')).forEach(btn => {
            btn.classList.toggle('selected', parseInt(btn.dataset.missed) === calculator.missedDays);
          });
        };
        document.getElementById('closeShiftModal').onclick = function() {
          document.getElementById('shiftModal').style.display = 'none';
        };
        // Close modal when clicking outside the modal content
        document.getElementById('shiftModal').addEventListener('mousedown', function(e) {
          if (e.target === this) {
            this.style.display = 'none';
          }
        });
        Array.from(document.querySelectorAll('#modalShiftsGrid .toggle-btn')).forEach(btn => {
          btn.onclick = function() {
            calculator.shifts = parseInt(btn.dataset.shifts);
            calculator.calculate();
            updateShiftSummary();
          };
        });
        Array.from(document.querySelectorAll('#modalMissedGrid .toggle-btn')).forEach(btn => {
          btn.onclick = function() {
            calculator.missedDays = parseInt(btn.dataset.missed);
            calculator.calculate();
            updateShiftSummary();
          };
        });
        function updateShiftSummary() {
          document.getElementById('shiftSummary').textContent = `·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éò·Éó·Éò ·É°·Éõ·Éî·Éú·Éî·Éë·Éò: ${calculator.shifts} | ·Éí·Éê·É™·Éì·Éî·Éú·Éî·Éë·Éò: ${calculator.missedDays}`;
        }
        updateShiftSummary();
    </script>
    <!-- 
     changelog:
    // v0.4 -> 0.5: 
    ·É°·Éò·É•·Éù·Éö·Éò·É° ·Éì·Éê·Éó·Éï·Éö·Éê: 12·É°·Éó ·Éì·Éê 1.5 ·É©·Éê·Éò·Éì·Éê·Éú  (line:1192 - Changed from EXTRA_SHIFT_HOURS to REGULAR_HOURS ) (line: 1219 - added 1.5x)
    note: ·É°·Éò·É•·Éù·Éö·É° + ·Éì·Éù·Éû·Éò = +0.5 ·Éì·É¶·Éò·É° ·ÉÆ·Éî·Éö·É§·Éê·É°·Éò ?
    // v0.5 -> 0.6:
    ·Éì·Éù·Éû·Éò·É° ·Éì·Éê ·É°·Éò·É•·Éù·Éö·Éò·É° ·Éí·Éê·Éë·Éê·Éó·Éò·Éö·Éî·Éë·Éê
    // v0.6 -> 0.7:
    removed notice baner
    -->
</body>
</html>